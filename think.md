# 问题和思考

### 不同模组的平台是否要部署成一个app：

- 不部署在一起，要做到统一入口的形式呈现，需要考虑不同app 之间的session 共享。（可以通过redis来实现）
- 不部署在一起的好处：
    1. 运行的一个app的不稳定性不会影响到另外一个
    2. 可以视负载高低来决定部署的相同app的多少
    3. 一个app代表一项业务，便于拓展

### 事务要精简：

- 复杂而又频繁的事务，容易引起数据库的死锁。
- 业务抽象过程是否可以再解藕，需要重新认识。
    1. 逻辑单元之间的联系是否符合事务的特征（要么全做，要么不做）
    2. 晚点做可以吗？比如：事前控制是否可以改为事后检查？
    常见场景有：写日志、回写数据/同步状态、发消息、等实时性不高或重要级别不对等的地方。
- 必须使用事务的地方，代码实现的方式: 优先使用pl/sql调用
    1. 方便调试
    2. 匿名函数，非存储过程
    3. 数据库只存数据，无需体现业务逻辑，也无法记录历史变更
    4. 复杂的业务，使用orm用途不大

### 消息队列的特征：

- 实现事情晚点做的方式（现场只是发消息，做事是队列的事情）
- 消息在队列需要排队，避免高并发
- 多个队列可以实现并行作业或高可用
- 消息选择结果确认时，增加执行的可靠性
- 进一步确保执行结果，可以监控并定期补漏
- 我选rabbitmq, 简单而又复杂

***

### 重构的步骤：

- 业务的再梳理、流程优化、实现系统目标提升为目的
- 蚂蚁搬家，分模组（按模组业务流程先后，后者先迭代）
- 数据库调整放最后

***

### web和api是否在同一个app(//ip:port) 下部署：

- 主要考虑到：如果不在存在跨域调用的问题要解决，在一起会更轻松。
- 但是，1个平台多个app之间业务串联的问题又不可避免。（一个app 的web 不允许也无法直接调用另一个app下的 api）
- 结论：多个app无法回避跨域调用问题，需要解决，只能分开。
- 解决办法：
    1. 优先：服务器端限制本域名全子域访问
    2. 其次：调用所在app下的api，在api的内部去访问另外一个app 的api。
    3. 最后最好不考虑jsonp的形式

### 不同app是否放在一个程序项目集（目录）下管理：

- 放一起，可以有多个入口主文件，故不影响分别部署
- 不同的系统类型，系统子目录或依赖包不完全相同，没有必要放一起
- 结论：同一个系统类型的放一起，不同类型的不放一起
- web api job

### 项目和应用命名

- alias[web|api]
- [web|api]-subDomain

### 开发历程

1. 需求分析
    - 领域业务梳理分类
    - 抽象业务主体对象
    - 精简优化业务流程
2. 业务抽象
    - 领域对象
    - 流程和事务
    - 属性方法
    - 约定与受限
3. 归纳规范
    - 中英文名词/动词
    - 文档标准化

